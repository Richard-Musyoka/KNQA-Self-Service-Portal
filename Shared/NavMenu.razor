<div class="top-row ps-3 navbar navbar-dark bg-primary">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="">
            <span class="oi oi-grid-three-up me-2"></span>
            KNQA Self-Service
        </a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass nav-scrollable" @onclick="ToggleNavMenu">
    <nav class="flex-column p-3">

        <!-- Dashboard -->
        <div class="nav-item px-2">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home me-2" aria-hidden="true"></span>
                Dashboard
            </NavLink>
        </div>

        <div class="nav-divider"></div>

        <!-- Leave Management -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Leave Management"
                         Icon="@Icons.Material.Filled.DateRange"
                         Expanded="@(expandedGroup == "leave")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("leave", expanded))">
                <MudNavLink Href="leave-planning">Leave Planning</MudNavLink>
                <MudNavLink Href="leave-application">Apply Leave</MudNavLink>
            </MudNavGroup>
        </div>

        <!-- Performance Management -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Performance Management"
                         Icon="@Icons.Material.Filled.Assessment"
                         Expanded="@(expandedGroup == "performance")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("performance", expanded))">
                <MudNavLink Href="performance-targets">Target Setting</MudNavLink>
                <MudNavLink Href="appraisals">Appraisal</MudNavLink>
            </MudNavGroup>
        </div>

        <!-- Training & Development -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Training & Development"
                         Icon="@Icons.Material.Filled.School"
                         Expanded="@(expandedGroup == "training")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("training", expanded))">
                <MudNavLink Href="training-request">Request Training</MudNavLink>
                <MudNavLink Href="training-evaluation">Evaluation</MudNavLink>
            </MudNavGroup>
        </div>

        <div class="nav-divider"></div>

        <!-- Recruitment -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Job Requisition"
                         Icon="@Icons.Material.Filled.Business"
                         Expanded="@(expandedGroup == "recruitment")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("recruitment", expanded))">
                <MudNavLink Href="job-requisition">Job Requisition</MudNavLink>
            </MudNavGroup>
        </div>

        <div class="nav-divider"></div>

        <!-- Administrative Services -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Errand Services"
                         Icon="@Icons.Material.Filled.Home"
                         Expanded="@(expandedGroup == "errands")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("errands", expanded))">
                <MudNavLink Href="room-booking">Meeting Rooms</MudNavLink>
                <MudNavLink Href="transport-request">Transport</MudNavLink>
                <MudNavLink Href="vehicle-maintenance">Car Repair</MudNavLink>
            </MudNavGroup>
        </div>

        <div class="nav-divider"></div>

        <!-- Asset Management -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Asset Management"
                         Icon="@Icons.Material.Filled.Computer"
                         Expanded="@(expandedGroup == "assets")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("assets", expanded))">
                <MudNavLink Href="my-assets">My Assets</MudNavLink>
                <MudNavLink Href="fixed-assets">Fixed Assets</MudNavLink>
                <MudNavLink Href="asset-management">Asset Repairs</MudNavLink>
            </MudNavGroup>
        </div>

        <!-- IT Support -->
        <div class="nav-item px-2">
            <MudNavGroup Title="IT Support"
                         Icon="@Icons.Material.Filled.Support"
                         Expanded="@(expandedGroup == "it-support")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("it-support", expanded))">
                <MudNavLink Href="help-desk">Help Desk</MudNavLink>
                <MudNavLink Href="incident-management">Incidents</MudNavLink>
            </MudNavGroup>
        </div>

        <div class="nav-divider"></div>

        <!-- Administration -->
        <div class="nav-item px-2">
            <MudNavGroup Title="Administration"
                         Icon="@Icons.Material.Filled.Settings"
                         Expanded="@(expandedGroup == "admin")"
                         ExpandedChanged="@((bool expanded) => OnGroupExpandChanged("admin", expanded))"
                         Class="admin-nav-group">
                <MudNavLink Href="/users">Users</MudNavLink>
            </MudNavGroup>
        </div>

        <div class="nav-divider"></div>

        <!-- Personal & Profile -->
        <div class="nav-item px-2">
            <NavLink class="nav-link" href="profile">
                <span class="oi oi-person me-2" aria-hidden="true"></span>
                My Profile
            </NavLink>
        </div>

    </nav>
</div>

@code {
    private bool collapseNavMenu = true;
    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;
    private string? expandedGroup = null;

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private void OnGroupExpandChanged(string groupName, bool expanded)
    {
        if (expanded)
        {
            // Close all other groups and open only this one
            expandedGroup = groupName;
        }
        else
        {
            // If the user is closing the current group, allow it
            if (expandedGroup == groupName)
            {
                expandedGroup = null;
            }
        }

        StateHasChanged();
    }
}
